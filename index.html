<!DOCTYPE html>
<html lang="pt-br">
<head>
ย <meta charset="UTF-8" />
ย <title>Painel de Pontos</title>
ย
ย ย <style>
ย ย /* ==========================
ย ย ย ย ๐จ AJUSTES GLOBAIS
ย ย ย========================== */
ย ย * {
ย ย ย box-sizing: border-box;
ย ย }

ย ย body {
ย ย ย font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
ย ย ย ย Helvetica, Arial, sans-serif;
ย ย ย background-color: #f8f9fa; /* Fundo mais neutro */
ย ย ย margin: 0;
ย ย ย padding: 0;
ย ย ย color: #333;
ย ย }

ย ย .container {
ย ย ย max-width: 1100px; /* Um pouco mais largo */
ย ย ย margin: 30px auto;
ย ย ย background: white;
ย ย ย padding: 30px;
ย ย ย border-radius: 12px;
ย ย ย /* Sombra mais suave e moderna */
ย ย ย box-shadow: 0 4px 15px rgba(0, 0, 0, 0.07);
ย ย }

ย ย h1 {
ย ย ย text-align: center;
ย ย ย color: #2c3e50; /* Cor mais profissional */
ย ย ย margin-top: 0;
ย ย ย margin-bottom: 25px;
ย ย }

ย ย /* ==========================
ย ย ย ย ๐๏ธ FILTROS E AรรES
ย ย ย========================== */
ย ย .filtros {
ย ย ย display: flex;
ย ย ย flex-wrap: wrap;
ย ย ย gap: 12px;
ย ย ย align-items: center;
ย ย ย margin-bottom: 20px;
ย ย ย position: relative;
ย ย }

ย ย .filtros input {
ย ย ย padding: 10px 12px;
ย ย ย font-size: 15px;
ย ย ย border: 1px solid #ced4da;
ย ย ย border-radius: 6px;
ย ย ย transition: border-color 0.2s, box-shadow 0.2s;
ย ย }

ย ย .filtros input:focus {
ย ย ย border-color: #007bff;
ย ย ย box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.15);
ย ย ย outline: none;
ย ย }

ย ย .filtros button {
ย ย ย background-color: #007bff;
ย ย ย color: white;
ย ย ย border: none;
ย ย ย border-radius: 6px;
ย ย ย cursor: pointer;
ย ย ย padding: 10px 16px;
ย ย ย font-size: 15px;
ย ย ย font-weight: 500;
ย ย ย transition: background-color 0.2s;
ย ย }

ย ย .filtros button:hover {
ย ย ย background-color: #0056b3;
ย ย }

ย ย .autocomplete-container {
ย ย ย position: relative;
ย ย ย flex-grow: 1; /* Faz a busca ocupar mais espaรงo */
ย ย ย min-width: 250px;
ย ย }

ย ย #buscaFuncionario {
ย ย ย width: 100%; /* Ocupa todo o container */
ย ย }

ย ย .autocomplete-box {
ย ย ย position: absolute;
ย ย ย top: 100%;
ย ย ย left: 0;
ย ย ย right: 0;
ย ย ย background: white;
ย ย ย border: 1px solid #ddd;
ย ย ย border-top: none;
ย ย ย max-height: 200px;
ย ย ย overflow-y: auto;
ย ย ย z-index: 9999;
ย ย ย box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
ย ย ย border-radius: 0 0 6px 6px;
ย ย }

ย ย .autocomplete-box div {
ย ย ย padding: 10px;
ย ย ย cursor: pointer;
ย ย }

ย ย .autocomplete-box div:hover {
ย ย ย background-color: #f0f0f0;
ย ย }

ย ย /* --- โจ NOVO ESTILO PARA BARRA DE AรรES โจ --- */
ย ย .acoes-barra {
ย ย ย display: flex;
ย ย ย flex-wrap: wrap;
ย ย ย gap: 8px;
ย ย ย margin-bottom: 25px;
ย ย ย padding-bottom: 15px;
ย ย ย border-bottom: 1px solid #e9ecef;
ย ย }

ย ย .acoes-barra a,
ย ย .acoes-barra button {
ย ย ย text-decoration: none;
ย ย ย padding: 8px 12px;
ย ย ย border-radius: 6px;
ย ย ย font-size: 14px;
ย ย ย font-weight: 500;
ย ย ย cursor: pointer;
ย ย ย transition: background-color 0.2s, color 0.2s;
ย ย ย border: 1px solid #ced4da;
ย ย ย background-color: #f8f9fa;
ย ย ย color: #495057;
ย ย }

ย ย .acoes-barra a:hover,
ย ย .acoes-barra button:hover {
ย ย ย background-color: #e9ecef;
ย ย ย color: #000;
ย ย ย border-color: #adb5bd;
ย ย }

ย ย /* Botรฃo de exportar com destaque */
ย ย .acoes-barra button[onclick="exportarPDF()"] {
ย ย ย background-color: #28a745;
ย ย ย color: white;
ย ย ย border-color: #28a745;
ย ย ย margin-left: auto; /* Joga para a direita */
ย ย }

ย ย .acoes-barra button[onclick="exportarPDF()"]:hover {
ย ย ย background-color: #218838;
ย ย ย border-color: #1e7e34;
ย ย }

ย ย /* ==========================
ย ย ย ย ๐ TABELA DE PONTOS
ย ย ย========================== */
ย ย table {
ย ย ย width: 100%;
ย ย ย border-collapse: collapse;
ย ย ย background-color: white;
ย ย ย overflow-x: auto;
ย ย ย display: block;
ย ย ย border-radius: 8px;
ย ย ย box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
ย ย ย border: 1px solid #dee2e6;
ย ย }

ย ย /* --- โจ CABEรALHO DA TABELA โจ --- */
ย ย th {
ย ย ย background-color: #f1f3f5; /* Cinza claro uniforme */
ย ย ย color: #495057;
ย ย ย font-weight: 600;
ย ย ย padding: 12px 15px;
ย ย ย text-align: center;
ย ย ย /* Novo: visual mais "pro" */
ย ย ย text-transform: uppercase;
ย ย ย font-size: 12px;
ย ย ย letter-spacing: 0.5px;
ย ย ย border-bottom: 2px solid #dee2e6;
ย ย ย border-right: 1px solid #dee2e6;
ย ย }

ย ย th:last-child {
ย ย ย border-right: none;
ย ย }

ย ย /* Cabeรงalho do Nome do Funcionรกrio */
ย ย th[colspan="7"] {
ย ย ย background-color: #343a40; /* Fundo escuro */
ย ย ย color: white;
ย ย ย font-size: 1.1em;
ย ย ย text-align: left;
ย ย ย padding-left: 15px;
ย ย ย /* Reseta o estilo "pro" */
ย ย ย text-transform: none;
ย ย ย letter-spacing: 0;
ย ย ย border-bottom: 1px solid #495057;
ย ย }

ย ย /* --- โจ CORPO DA TABELA โจ --- */
ย ย td {
ย ย ย border: none; /* Remove bordas laterais */
ย ย ย border-bottom: 1px solid #e9ecef; /* Apenas borda inferior */
ย ย ย padding: 10px 15px;
ย ย ย text-align: center;
ย ย ย transition: background 0.2s;
ย ย ย color: #555;
ย ย ย font-size: 14px;
ย ย ย /* Coloca borda na direita para separar colunas */
ย ย ย border-right: 1px solid #e9ecef; 
ย ย }
ย ย 
ย ย td:last-child {
ย ย ย border-right: none;
ย ย }

ย ย /* --- โ REMOVIDO o fundo colorido por coluna โ --- */

ย ย /* --- โจ ADICIONADO "Zebra Striping" โจ --- */
ย ย tbody tr:nth-child(even) {
ย ย ย background-color: #fcfcfc; /* Cor sutil para linhas pares */
ย ย }

ย ย /* --- โจ HOVER NA LINHA INTEIRA โจ --- */
ย ย tbody tr:not(.domingo):hover {
ย ย ย background-color: #e6f7ff; /* Destaque azul claro */
ย ย ย cursor: pointer;
ย ย }

ย ย /* Cรฉlulas de ponto clicรกveis (data-tipo) */
ย ย td[data-tipo]:hover {
ย ย ย background-color: #d1f0ff;
ย ย ย font-weight: 500;
ย ย }

ย ย /* Estilo de Domingo (mantido) */
ย ย #tabelaPontos tbody tr.domingo {
ย ย ย background-color: #fffbe6;
ย ย ย color: #72620a;
ย ย ย font-weight: 500;
ย ย }

ย ย #tabelaPontos tbody tr.domingo td {
ย ย ย color: #8a760e;
ย ย }

ย ย #tabelaPontos tbody tr.domingo:hover {
ย ย ย background-color: #f7f2d2;
ย ย }

ย ย /* ==========================
ย ย ย ย ํ POPUP E PAINEL LATERAL
ย ย ย========================== */

ย ย /* === POPUP (modal flutuante) === */
ย ย .popup-overlay {
ย ย ย display: none;
ย ย ย position: fixed;
ย ย ย top: 0;
ย ย ย left: 0;
ย ย ย width: 100%;
ย ย ย height: 100%;
ย ย ย background-color: rgba(0, 0, 0, 0.5);
ย ย ย display: flex;
ย ย ย justify-content: center;
ย ย ย align-items: center;
ย ย ย z-index: 9999;
ย ย }

ย ย .popup {
ย ย ย background: #fff;
ย ย ย padding: 25px 30px;
ย ย ย border-radius: 10px;
ย ย ย box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
ย ย ย max-width: 350px;
ย ย ย width: 90%;
ย ย ย text-align: center;
ย ย ย animation: popupFadeIn 0.2s ease-in-out;
ย ย }

ย ย .popup h3 {
ย ย ย margin-top: 0;
ย ย ย margin-bottom: 20px;
ย ย ย font-size: 1.3em;
ย ย ย color: #333;
ย ย }

ย ย .popup input[type="time"] {
ย ย ย width: 100%;
ย ย ย padding: 10px;
ย ย ย margin-bottom: 20px;
ย ย ย font-size: 1.1em;
ย ย ย border: 1px solid #ccc;
ย ย ย border-radius: 6px;
ย ย }

ย ย .popup .botoes {
ย ย ย display: flex;
ย ย ย justify-content: space-between;
ย ย ย gap: 10px;
ย ย }

ย ย .popup button {
ย ย ย flex: 1;
ย ย ย padding: 10px 14px;
ย ย ย font-size: 1em;
ย ย ย border: none;
ย ย ย border-radius: 6px;
ย ย ย cursor: pointer;
ย ย ย transition: background-color 0.2s ease;
ย ย ย font-weight: 500;
ย ย }

ย ย .popup button.salvar {
ย ย ย background-color: #4caf50;
ย ย ย color: white;
ย ย }

ย ย .popup button.excluir {
ย ย ย background-color: #f44336;
ย ย ย color: white;
ย ย }

ย ย .popup button.cancelar {
ย ย ย background-color: #9e9e9e;
ย ย ย color: white;
ย ย }

ย ย .popup button:hover {
ย ย ย opacity: 0.85;
ย ย }

ย ย /* ===== Painel lateral ===== */
ย ย .painel-pendentes {
ย ย ย position: fixed;
ย ย ย top: 0;
ย ย ย right: -400px;
ย ย ย width: 350px;
ย ย ย height: 100%;
ย ย ย background: #fff;
ย ย ย box-shadow: -3px 0 10px rgba(0, 0, 0, 0.2);
ย ย ย transition: right 0.3s ease;
ย ย ย z-index: 2000;
ย ย ย display: flex;
ย ย ย flex-direction: column;
ย ย }

ย ย .painel-pendentes.ativo {
ย ย ย right: 0;
ย ย }

ย ย .painel-header {
ย ย ย display: flex;
ย ย ย justify-content: space-between;
ย ย ย align-items: center;
ย ย ย background: #007bff;
ย ย ย color: white;
ย ย ย padding: 12px 15px;
ย ย }

ย ย .painel-header h3 {
ย ย ย margin: 0;
ย ย ย font-size: 1.1em;
ย ย }

ย ย #btnFecharPendentes {
ย ย ย background: none;
ย ย ย border: none;
ย ย ย color: white;
ย ย ย font-size: 22px;
ย ย ย cursor: pointer;
ย ย ย padding: 0 5px;
ย ย }

ย ย .lista-pendentes {
ย ย ย flex: 1;
ย ย ย overflow-y: auto;
ย ย ย padding: 10px;
ย ย }

ย ย .lista-pendentes div {
ย ย ย background: #f5f5f5;
ย ย ย padding: 10px 12px;
ย ย ย border-radius: 6px;
ย ย ย margin-bottom: 8px;
ย ย ย font-size: 14px;
ย ย ย border-left: 4px solid #ff9800;
ย ย }
ย ย .lista-pendentes p {
ย ย ย padding: 10px;
ย ย ย text-align: center;
ย ย ย color: #777;
ย ย }

ย ย .btn-flutuante {
ย ย ย position: fixed;
ย ย ย bottom: 25px;
ย ย ย right: 25px;
ย ย ย background: #007bff;
ย ย ย color: white;
ย ย ย border: none;
ย ย ย border-radius: 50px;
ย ย ย padding: 12px 22px;
ย ย ย font-size: 15px;
ย ย ย cursor: pointer;
ย ย ย box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3);
ย ย ย transition: background 0.2s, transform 0.2s;
ย ย ย z-index: 1500;
ย ย ย font-weight: 500;
ย ย }

ย ย .btn-flutuante:hover {
ย ย ย background: #0056b3;
ย ย ย transform: translateY(-2px);
ย ย }

ย ย @keyframes popupFadeIn {
ย ย ย from {
ย ย ย ย opacity: 0;
ย ย ย ย transform: scale(0.9);
ย ย ย }
ย ย ย to {
ย ย ย ย opacity: 1;
ย ย ย ย transform: scale(1);
ย ย ย }
ย ย }
ย </style>
</head>
<body>
ย <div class="container">
ย ย <h1>Painel Administrativo</h1>

ย ย <div class="filtros">
ย ย ย <div class="autocomplete-container">
ย ย ย ย <input
ย ย ย ย ย type="text"
ย ย ย ย ย id="buscaFuncionario"
ย ย ย ย ย placeholder="Buscar por nome ou CPF"
ย ย ย ย ย autocomplete="off"
ย ย ย ย />
ย ย ย ย <div id="sugestoes" class="autocomplete-box"></div>
ย ย ย </div>

ย ย ย <input type="date" id="filtroData" />
ย ย ย <input type="month" id="filtroMes" />
ย ย ย <button onclick="buscarPontos()">Buscar</button>
ย ย </div>

ย ย <div class="acoes-barra">
ย ย ย <a href="cadastrar.html">Cadastrar Funcionรกrio</a>
ย ย ย <a href="editar.html">Editar Funcionรกrio</a>
ย ย ย <a href="excluir.html">Excluir Funcionรกrio</a>
ย ย ย <a href="editar-ponto.html">Editar Ponto</a>
ย ย ย <a href="adicionar-ponto.html">Adicionar Ponto</a>
ย ย ย <button onclick="exportarPDF()">Exportar PDF</button>
ย ย </div>

ย ย <table id="tabelaPontos">
ย ย ย <thead>
ย ย ย ย <tr>
ย ย ย ย ย <th colspan="7" id="nomeFuncionario">Funcionรกrio: -</th>
ย ย ย ย </tr>
ย ย ย ย <tr>
ย ย ย ย ย <th>Data</th>
ย ย ย ย ย <th>Entrada (Manhรฃ)</th>
ย ย ย ย ย <th>Saรญda (Almoรงo)</th>
ย ย ย ย ย <th>Retorno (Almoรงo)</th>
ย ย ย ย ย <th>Saรญda (Tarde)</th>
ย ย ย ย ย <th>Horas Trabalhadas</th>
ย ย ย ย ย <th>Horas Extras</th>
ย ย ย ย </tr>
ย ย ย </thead>
ย ย ย <tbody></tbody>
ย ย </table>

ย ย ย ย <div id="popupOverlay" class="popup-overlay">
ย ย ย <div class="popup">
ย ย ย ย <h3 id="popupTitulo">Editar Ponto</h3>
ย ย ย ย <input type="time" id="campoValor" step="1" />
ย ย ย ย <div class="botoes">
ย ย ย ย ย <button class="salvar" id="btnSalvar">Salvar</button>
ย ย ย ย ย <button class="excluir" id="btnExcluir">Excluir</button>
ย ย ย ย ย <button class="cancelar" id="btnFechar">Cancelar</button>
ย ย ย ย </div>
ย ย ย </div>
ย ย </div>
ย </div>

ย ย <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
ย <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

ย ย <div id="painelPendentes" class="painel-pendentes">
ย ย <div class="painel-header">
ย ย ย <h3>Pontos Pendentes de Hoje</h3>
ย ย ย <button id="btnFecharPendentes">ร</button>
ย ย </div>
ย ย <div id="listaPendentes" class="lista-pendentes">
ย ย ย <p>Carregando...</p>
ย ย </div>
ย </div>

ย <button id="btnAbrirPendentes" class="btn-flutuante">โก Pendentes</button>

ย ย <script type="module">
ย ย import {
ย ย ย initializeApp,
ย ย } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
ย ย import {
ย ย ย getFirestore,
ย ย ย collection,
ย ย ย getDocs,
ย ย ย query,
ย ย ย where,
ย ย ย addDoc,
ย ย ย updateDoc,
ย ย ย deleteDoc,
ย ย ย doc,
ย ย } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

ย ย // ==========================
ย ย // ๐น Configuraรงรฃo Firebase
ย ย // ==========================
ย ย const firebaseConfig = {
ย ย ย apiKey: "AIzaSyCuCbBesvbrOvdzdv1cmCF7M2uaaUfWRU0",
ย ย ย authDomain: "meupontoapp-d5d3b.firebaseapp.com",
ย ย ย projectId: "meupontoapp-d5d3b",
ย ย ย storageBucket: "meupontoapp-d5d3b.appspot.com",
G ย ย messagingSenderId: "700159340275",
ย ย ย appId: "1:700159340275:web:51094e94b4159521cf5186",
ย ย };

ย ย const app = initializeApp(firebaseConfig);
ย ย const db = getFirestore(app);

ย ย // ==========================
ย ย // ๐น Painel de Pontos Pendentes
ย ย // ==========================
ย ย const painelPendentes = document.getElementById("painelPendentes");
ย ย const listaPendentes = document.getElementById("listaPendentes");
ย ย const btnAbrirPendentes = document.getElementById("btnAbrirPendentes");
ย ย const btnFecharPendentes = document.getElementById("btnFecharPendentes");

ย ย // ==========================
ย ย // ๐น Variรกveis globais
ย ย // ==========================
ย ย const inputBusca = document.getElementById("buscaFuncionario");
ย ย const sugestoesBox = document.getElementById("sugestoes");
ย ย let funcionarios = [];
ย ย let cpfSelecionado = null;
ย ย const overlay = document.getElementById("popupOverlay");

ย ย // ==========================
ย ย // ๐น Funรงรตes auxiliares
ย ย // ==========================
ย ย function formatarData(dataStr) {
ย ย ย const partes = dataStr.split("-");
ย ย ย if (partes.length !== 3) return dataStr;
ย ย ย return `${partes[2]}/${partes[1]}/${partes[0]}`;
ย ย }

ย ย // ==========================
ย ย // ๐น Carregar funcionรกrios
ย ย // ==========================
ย ย async function carregarFuncionarios() {
ย ย ย try {
ย ย ย ย const colRef = collection(db, "funcionarios");
ย ย ย ย const snapshot = await getDocs(colRef);

ย ย ย ย funcionarios = snapshot.docs.map((doc) => doc.data());
ย ย ย } catch (e) {
ย ย ย ย console.error("Erro carregando funcionรกrios:", e);
ย ย ย }
ย ย }
ย ย carregarFuncionarios();

ย ย // ==========================
ย ย // ๐น Autocomplete
ย ย // ==========================
ย ย inputBusca.addEventListener("input", () => {
ย ย ย const termo = inputBusca.value.toLowerCase();
ย ย ย sugestoesBox.innerHTML = "";

ย ย ย if (!termo) return;

ย ย ย const encontrados = funcionarios.filter(
ย ย ย ย (f) => f.nome.toLowerCase().includes(termo) || f.cpf.includes(termo)
ย ย ย );

ย ย ย encontrados.slice(0, 5).forEach((f) => {
ย ย ย ย const div = document.createElement("div");
ย ย ย ย div.textContent = `${f.nome} (${f.cpf})`;
ย ย ย ย div.onclick = () => {
ย ย ย ย ย inputBusca.value = `${f.nome} (${f.cpf})`;
ย ย ย ย ย sugestoesBox.innerHTML = "";
ย ย ย ย ย cpfSelecionado = f.cpf;
ย ย ย ย };
ย ย ย ย sugestoesBox.appendChild(div);
ย ย ย });
ย ย });

ย ย // ==========================
ย ย // ๐น Buscar pontos (VERSรO ATUALIZADA)
ย ย // ==========================
ย ย async function buscarPontos() {
ย ย ย const cpfTexto = inputBusca.value.match(/\(([^)]+)\)$/);
ย ย ย const cpf = cpfTexto ? cpfTexto[1] : inputBusca.value.trim();
ย ย ย cpfSelecionado = cpf;

ย ย ย if (!cpf) {
ย ย ย ย alert("Selecione um funcionรกrio vรกlido!");
ย ย ย ย return;
ย ย ย }

ย ย ย const filtroMes = document.getElementById("filtroMes").value;
ย ย ย if (!filtroMes) {
ย ย ย ย alert("Por favor, selecione um MรS para gerar o relatรณrio completo.");
ย ย ย ย return;
ย ย ย }

ย ย ย try {
ย ย ย ย const colRef = collection(db, "pontos");
ย ย ย ย const q = query(colRef, where("cpf", "==", cpf));
ย ย ย ย const snapshot = await getDocs(q);

ย ย ย ย const pontosPorData = {};

ย ย ย ย snapshot.forEach((doc) => {
ย ย ย ย ย const d = doc.data();
ย ย ย ย ย if (!d.data) return;
ย ย ย ย ย if (filtroMes && !d.data.startsWith(filtroMes)) return;

ย ย ย ย ย if (!pontosPorData[d.data]) {
ย ย ย ย ย ย pontosPorData[d.data] = {
ย ย ย ย ย ย ย entrada_manha: "-",
ย ย ย ย ย ย ย saida_almoco: "-",
ย ย ย ย ย ย ย retorno_almoco: "-",
ย ย ย ย ย ย ย saida_tarde: "-",
ย ย ย ย ย ย };
ย ย ย ย ย }
ย ย ย ย ย pontosPorData[d.data][d.tipo] = d.hora || "-";
ย ย ย ย });

ย ย ย ย const tabelaCorpo = document.querySelector("#tabelaPontos tbody");
ย ย ย ย tabelaCorpo.innerHTML = "";

ย ย ย ย const nomeFuncionarioEl = document.getElementById("nomeFuncionario");
ย ย ย ย const funcionarioNome =
ย ย ย ย ย funcionarios.find((f) => f.cpf === cpf)?.nome || "Funcionรกrio";
ย ย ย ย nomeFuncionarioEl.textContent = `Funcionรกrio: ${funcionarioNome}`;

ย ย ย ย const [ano, mes] = filtroMes.split("-").map(Number);
ย ย ย ย const diasNoMes = new Date(ano, mes, 0).getDate();

ย ย ย ย for (let dia = 1; dia <= diasNoMes; dia++) {
ย ย ย ย ย const dataAtual = new Date(ano, mes - 1, dia);
ย ย ย ย ย const diaDaSemana = dataAtual.getDay(); // 0 = Domingo

ย ย ย ย ย const diaStr = String(dia).padStart(2, "0");
ย ย ย ย ย const mesStr = String(mes).padStart(2, "0");
ย ย ย ย ย const dataChave = `${ano}-${mesStr}-${diaStr}`;

ย ย ย ย ย const ponto = pontosPorData[dataChave] || {
ย ย ย ย ย ย entrada_manha: "-",
ย ย ย ย ย ย saida_almoco: "-",
ย ย ย ย ย ย retorno_almoco: "-",
ย ย ย ย ย ย saida_tarde: "-",
ย ย ย ย ย };

ย ย ย ย ย const classeDomingo = diaDaSemana === 0 ? 'class="domingo"' : "";

ย ย ย ย ย tabelaCorpo.innerHTML += `
ย ย ย ย ย ย <tr ${classeDomingo}>
ย ย ย ย ย ย ย <td>${formatarData(dataChave)}</td>
ย ย ย ย ย ย ย <td data-tipo="entrada_manha">${ponto.entrada_manha}</td>
ย ย ย ย ย ย ย <td data-tipo="saida_almoco">${ponto.saida_almoco}</td>
ย ย ย ย ย ย ย <td data-tipo="retorno_almoco">${ponto.retorno_almoco}</td>
ย ย ย ย ย ย ย <td data-tipo="saida_tarde">${ponto.saida_tarde}</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td>-</td>
ย ย ย ย ย ย ย <td>-</td>
ย ย ย ย ย ย </tr>
ย ย ย ย ย `;
ย ย ย ย }
ย ย ย } catch (e) {
ย ย ย ย console.error("Erro buscando pontos:", e);
ย ย ย }
ย ย }
ย ย window.buscarPontos = buscarPontos; // Expondo a funรงรฃo para o HTML

ย ย // ==========================
ย ย // ๐น Popup de ediรงรฃo
ย ย // ==========================
ย ย let celulaSelecionada = null;
ย ย let dataSelecionada = null;
ย ย let tipoSelecionado = null;
ย ย let docIdSelecionado = null;

ย ย overlay.addEventListener("click", (event) => {
ย ย ย if (event.target === overlay) {
ย ย ย ย fecharPopup();
ย ย ย }
ย ย });

ย ย document.addEventListener("click", async (e) => {
ย ย ย const td = e.target.closest("td");
ย ย ย if (!td || td.closest("thead")) return;

ย ย ย const tipo = td.dataset.tipo;
ย ย ย if (!tipo) return; // Ignora cรฉlulas sem data-tipo (Data, Horas Trab, Horas Extra)

ย ย ย celulaSelecionada = td;
ย ย ย const tr = td.parentElement;
ย ย ย dataSelecionada = tr.children[0].textContent.trim();
ย ย ย tipoSelecionado = tipo;

ย ย ย const valor = td.textContent.trim() !== "-" ? td.textContent.trim() : "";
ย ย ย document.getElementById("campoValor").value = valor;
ย ย ย document.getElementById("popupTitulo").textContent = valor
ย ย ย ย ? "Editar Ponto"
ย ย ย ย : "Adicionar Ponto";

ย ย ย const dataFirestore = dataSelecionada.split("/").reverse().join("-");

ย ย ย try {
ย ย ย ย const q = query(
ย ย ย ย ย collection(db, "pontos"),
ย ย ย ย ย where("cpf", "==", cpfSelecionado),
ย ย ย ย ย where("data", "==", dataFirestore),
ย ย ย ย ย where("tipo", "==", tipoSelecionado)
ย ย ย ย );
ย ย ย ย const snap = await getDocs(q);
ย ย ย ย docIdSelecionado = snap.empty ? null : snap.docs[0].id;
ย ย ย } catch (err) {
ย ย ย ย console.error("Erro ao buscar documento:", err);
ย ย ย ย docIdSelecionado = null;
ย ย ย }

ย ย ย overlay.style.display = "flex";
ย ย });

ย ย function fecharPopup() {
ย ย ย document.getElementById("popupOverlay").style.display = "none";
ย ย ย celulaSelecionada = null;
ย ย }

ย ย document.getElementById("btnFechar").addEventListener("click", fecharPopup);

ย ย document.getElementById("btnSalvar").addEventListener("click", async () => {
ย ย ย if (!celulaSelecionada || !cpfSelecionado) return;

ย ย ย const novoValor = document.getElementById("campoValor").value.trim();
ย ย ย if (!novoValor) return alert("Informe um horรกrio vรกlido!");

ย ย ย const dataFirestore = dataSelecionada.split("/").reverse().join("-");

ย ย ย try {
ย ย ย ย if (docIdSelecionado) {
ย ย ย ย ย await updateDoc(doc(db, "pontos", docIdSelecionado), { hora: novoValor });
ย ย ย ย } else {
ย ย ย ย ย const novoDoc = await addDoc(collection(db, "pontos"), {
ย ย ย ย ย ย cpf: cpfSelecionado,
ย ย ย ย ย ย data: dataFirestore,
ย ย ย ย ย ย tipo: tipoSelecionado,
ย ย ย ย ย ย hora: novoValor,
ย ย ย ย ย });
ย ย ย ย ย docIdSelecionado = novoDoc.id; // Armazena o ID do novo doc
ย ย ย ย }

ย ย ย ย celulaSelecionada.textContent = novoValor;
ย ย ย ย alert("Ponto salvo com sucesso!");
ย ย ย } catch (err) {
ย ย ย ย console.error("Erro ao salvar:", err);
ย ย ย ย alert("Erro ao salvar no banco de dados!");
ย ย ย }

ย ย ย fecharPopup();
ย ย });

ย ย document.getElementById("btnExcluir").addEventListener("click", async () => {
ย ย ย if (!celulaSelecionada) return;

ย ย ย try {
ย ย ย ย if (docIdSelecionado) {
ย ย ย ย ย await deleteDoc(doc(db, "pontos", docIdSelecionado));
ย ย ย ย }
ย ย ย ย celulaSelecionada.textContent = "-";
ย ย ย ย alert("Ponto excluรญdo com sucesso!");
ย ย ย } catch (err) {
ย ย ย ย console.error("Erro ao excluir:", err);
ย ย ย ย alert("Erro ao excluir do banco de dados!");
ย ย ย }

ย ย ย fecharPopup();
ย ย });

ย ย // ==========================
ย ย // ๐น Painel Pendentes
ย ย // ==========================
ย ย btnAbrirPendentes.addEventListener("click", carregarPendentes);
ย ย btnFecharPendentes.addEventListener("click", () =>
ย ย ย painelPendentes.classList.remove("ativo")
ย ย );

ย ย async function carregarPendentes() {
ย ย ย painelPendentes.classList.add("ativo");
ย ย ย listaPendentes.innerHTML = "<p>Carregando...</p>";

ย ย ย const hoje = new Date().toISOString().split("T")[0]; // formato YYYY-MM-DD
ย ย ย const colRef = collection(db, "pontos");

ย ย ย try {
ย ย ย ย const snapshot = await getDocs(colRef);
ย ย ย ย const pontosHoje = {};
ย ย ย ย snapshot.forEach((docSnap) => {
ย ย ย ย ย const d = docSnap.data();
ย ย ย ย ย if (d.data === hoje) {
ย ย ย ย ย ย if (!pontosHoje[d.cpf]) pontosHoje[d.cpf] = {};
ย ย ย ย ย ย pontosHoje[d.cpf][d.tipo] = d.hora;
ย ย ย ย ย }
ย ย ย ย });

ย ย ย ย const tiposDePonto = [
ย ย ย ย ย "entrada_manha",
ย ย ย ย ย "saida_almoco",
ย ย ย ย ย "retorno_almoco",
ย ย ย ย ย "saida_tarde",
ย ย ย ย ];

ย ย ย ย const pendentes = funcionarios
ย ย ย ย ย .map((f) => {
ย ย ย ย ย ย const p = pontosHoje[f.cpf] || {};
ย ย ย ย ย ย const faltando = tiposDePonto.filter((t) => !p[t]);
ย ย ย ย ย ย return { nome: f.nome, cpf: f.cpf, faltando };
ย ย ย ย ย })
ย ย ย ย ย .filter((f) => f.faltando.length > 0);

ย ย ย ย if (pendentes.length === 0) {
ย ย ย ย ย listaPendentes.innerHTML = "<p>Todos os funcionรกrios estรฃo em dia โ</p>";
ย ย ย ย ย return;
ย ย ย ย }

ย ย ย ย listaPendentes.innerHTML = pendentes
ย ย ย ย ย .map(
ย ย ย ย ย ย (p) => `
ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย <strong>${p.nome}</strong> (${p.cpf})<br>
ย ย ย ย ย ย ย <small>Faltando: ${p.faltando.join(", ")}</small>
ย ย ย ย ย ย </div>
ย ย ย ย ย `
ย ย ย ย ย )
ย ย ย ย ย .join("");
ย ย ย } catch (e) {
ย ย ย ย console.error("Erro ao carregar pendentes:", e);
ย ย ย ย listaPendentes.innerHTML = "<p>Erro ao carregar dados.</p>";
ย ย ย }
ย ย }
ย ย 
ย ย // Funรงรตes de Exportaรงรฃo (ainda nรฃo implementadas)
ย ย function exportarPDF() {
ย ย ย alert("Funรงรฃo Exportar PDF ainda nรฃo implementada.");
ย ย }
ย ย window.exportarPDF = exportarPDF;

ย </script>
</body>
</html>

